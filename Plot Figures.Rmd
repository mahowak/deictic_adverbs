---
title: "Plot Figures"
author: "Sihan Chen, Richard Futrell, Kyle Mahowald"
date: '2022-09-25'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyverse)
library(ggrepel)
library(RColorBrewer)
library(ggnewscale)
library(latex2exp)
library(gridExtra)
library(ggrepel)
```

Insert descriptions here I guess

Parameters:
```{r}
# decay parameter
mu <- 0.3
# P/G/S coordinates
pgs <- '0.0_-0.789_1.316'
# number of distal levels
num_dists <- 'num_dists_3'
```

Load datasheets generated by run_ib_new.py
```{r}
# output file 
d = read.csv(paste0('sheets/_mu_',toString(mu),'_pgs', pgs, num_dists, '.csv'))  %>%
  mutate(Language = gsub('\\[(.*?)\\]', '', Language)) %>% pivot_longer(2:10, names_to = 'mode', values_to = 'word') %>%
  separate(mode, into = c('distal_level', 'orientation'), sep = '_') %>% group_by(Language) %>% 
  mutate(word = as.character(word) %>% factor(levels = unique(.)) %>% as.numeric()) %>% ungroup() %>%
  unite('mode', c('distal_level', 'orientation'), sep = '_') %>%
  pivot_wider(names_from = mode, values_from = word)

# non-deterministic optimal frontier
curve_non_deter = read.csv(paste0('sheets/ib_curve.csv'))

# get columns indicating the (distal_level, orientation) combinations
co <- which(!is.na(str_extract(colnames(d), 'D\\d_')))

# calculate number of words 
d[, "nwords"] <- apply(d[,co], 1, max) 

```


### Data sheet 1: Real paradigm summary

A paradigm is defined as a group of lexicons sharing the same partition of the meaning space. For example, both English and Maltese merge Place and Goal and have two distal levels, along with 21 other languages. These 23 languages are said to share the same paradigm.

From the sheet, among the 220 languages in the database, there are only 34 paradigms.
```{r}
real_paradigm_summary <- d %>% filter(LangCategory == 'real') %>% group_by_at(vars(starts_with('D', ignore.case = FALSE))) %>% slice_sample(n=1) %>% 
  left_join(d %>% group_by_at(vars(starts_with('D', ignore.case = FALSE))) %>% summarise(n = n())) %>% ungroup() %>% mutate(Language = gsub('^\\s+', '', Language))
```

### Generate plots:
Figure 1 in the paper: complexity - informativity tradeoff illustration:
```{r}
most_informative_example <- tibble(orientation = c('goal', 'place', 'source', 'goal', 'place', 'source', 'goal', 'place', 'source',
                                                   'goal', 'place', 'source', 'goal', 'place', 'source', 'goal', 'place', 'source'),
                                   distal_level = c('D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D3', 'D3', 'D3',
                                                    'D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D3', 'D3', 'D3'),
                                   word = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 2,2,2,2,2,2,2,2,2),
                                   cat = c(rep("Most informative", 9), rep("Most simple", 9)))

systematic_example <- tibble(orientation = c('goal', 'place', 'source', 'goal', 'place', 'source', 'goal', 'place', 'source',
                                                   'goal', 'place', 'source', 'goal', 'place', 'source', 'goal', 'place', 'source'),
                                   distal_level = c('D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D3', 'D3', 'D3',
                                                    'D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D3', 'D3', 'D3'),
                                   word = c(1,1,2,3,3,4,3,3,4,1,2,2,3,1,3,4,2,3),
                                   cat = c(rep("systematic", 9), rep("non_systematic", 9)))


ggplot(most_informative_example, aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  geom_tile() +
  facet_wrap(~cat) +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(25) +
  theme(legend.position = 'none') 

#ggsave(paste0('figures/mu_', toString(mu), 'tradeoff_illu_', num_dists, '.png'), width = 8, height = 4, unit = 'in')
ggsave(paste0('figures/paper_figures/Figure 1.png'), width = 8, height = 4, units = 'in')
```

Figure 3 in the paper: examples of systematic and non-systematic lexicons
```{r}
systematic_plot <- ggplot(d %>% filter(Language == 'English (Indo-European, Germanic)') %>% 
               pivot_longer(co,names_to = 'mode', values_to = 'word') %>% 
               separate(mode, into = c('distal_level', 'orientation'), sep = '_'), 
             aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  geom_tile() +
  facet_wrap(~Language) +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(17) +
  guides(fill = guide_legend(title = 'Word')) 

non_systematic_viz <- ggplot(d_sim %>% filter(X == 6685) %>% 
               pivot_longer(co_sim,names_to = 'mode', values_to = 'word') %>% 
               separate(mode, into = c('distal_level', 'orientation'), sep = '_'), 
             aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  geom_tile() +
  facet_wrap(~X) +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(17) +
  guides(fill = guide_legend(title = 'Word')) 

w <- grid.arrange(systematic_plot, non_systematic_viz, ncol=2)
#ggsave(paste0('figures/mu_', toString(mu), '_suystematicity_illu_', num_dists, '.png'), plot = w, width = 12, height = 4, unit = 'in')
ggsave(plot =w, paste0('figures/paper_figures/Figure 3.png'), width = 12, height = 4, units = 'in')

```
Figure 4 in the paper: real and simulated lexicons, along with the optimal frontier, on the information plane

```{r}
pos <- position_jitter(height = 0.01, width = 0.01, seed = 2)
ggplot(d %>% filter(LangCategory == 'real'), aes(x=`I.U.W.`, y=`I.M.W.`)) +
  geom_point(data = d %>% filter(LangCategory == 'simulated'), aes(x=`I.M.W.`, y=`I.U.W.`), alpha = 0.1, size = 3, color = 'gray') +
  geom_jitter(aes(x=`I.M.W.`, y=`I.U.W.`, color = Area), size = 3, position = pos) +
  geom_line(data = curve_non_deter, aes(x = complexity, y = informativity ), color = 'black', size = 1) +
  theme_bw(25) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  xlab('Complexity') +
  ylab('Informativity') +
  xlim(0,max(d$I.M.W.) + 0.35) +
  ylim(0,max(d$I.U.W.) + 0.10) +
  scale_color_brewer(palette = 'Set2') +
  geom_text_repel(data = d %>% filter(Language %in% c('Abau (Sepik, Upper) ',
                                                      '  Doromu-Koki (Trans-New Guinea, Manubaran) ',
                                                      'Balese (Central Sudanic)')),
                  aes(x = I.M.W., y = I.U.W., label = Language),
                  point.padding = 0.1,
                  nudge_x = -0.05,
                  nudge_y = -0.05,
                  segment.curvature = -1e-20,
                  arrow = arrow(length = unit(0.015, "npc")),
                  #position = pos
  )+
  geom_text_repel(data = d %>% filter(Language %in% c('  Dyirbal (Pama-Nyungan)',
                                                      '  Kodiak Alutiiq (Eskimo-Aleut, Aleut) ',
                                                      'Hmong Njua (Hmong-Mien, Chuanqiandian)',
                                                      'English (Indo-European, Germanic)'
                                                      )),
                  aes(x = I.M.W., y = I.U.W., label = Language),
                  point.padding = 0.1,
                  nudge_x = -0.05,
                  nudge_y = 0.05,
                  segment.curvature = -1e-20,
                  arrow = arrow(length = unit(0.015, "npc"))
  )+
  ggtitle('')

#ggsave(paste0('figures/Efficient_frontier_mu_',toString(mu),'_pgs_', pgs, num_dists, '.png'), width = 15.3, height = 9, units = 'in')
ggsave(paste0('figures/paper_figures/Figure 4.png'), width = 15.3, height = 9, units = 'in')

```

Figure 6 in the paper: most efficient real and simulated paradigms
```{r}
# color patelle for plotting
colourCount = 9
getPalette = colorRampPalette(brewer.pal(9, "Set1"))

# filter out optimal real lexicons 
real_lexicon_opts <- real_paradigm_summary %>% slice_min(order_by = gNID, n=5)
real_lexicon_opts_viz <- real_lexicon_opts %>% pivot_longer(co,names_to = 'mode', values_to = 'word') %>% 
  separate(mode, into = c('distal_level', 'orientation'), sep = '_')

p1 <- ggplot(real_paradigm_summary %>% mutate(Language = gsub('\\((.*?)\\)', '', Language),
                                              Label = paste0(str_sub(Language, 1, -2), "(", n, "), gNID = ", 
                                                             sprintf('%.4f', as.numeric(gNID))))  %>% filter() %>%
               slice_min(order_by = gNID, n =5) %>% 
               pivot_longer(co, names_to = 'mode', values_to = 'word') %>%
               separate(mode, into = c('distal_level', 'orientation'), sep = '_'),  
             aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  facet_wrap(~reorder(Label, nwords), nrow=2 ) +
  geom_tile() +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(17) +
  guides(fill = guide_legend(title = 'Word')) +
  ggtitle('real paradigms')
#ggsave(paste0('figures/mu_', toString(mu), '_optimal_simulated_lexicon_', num_dists, '.png'), plot = p1, width = 12, height = 4, unit = 'in')

# filter out optimal simulated lexicons 
sim_lexicon_opts <- d %>% filter(LangCategory == 'simulated') %>% slice_min(order_by = gNID, n=5) 
sim_lexicon_opts_viz <- sim_lexicon_opts %>% pivot_longer(co,names_to = 'mode', values_to = 'word') %>% 
  separate(mode, into =c('distal_level', 'orientation'), sep = '_')

p2 <- ggplot(sim_lexicon_opts_viz %>% mutate(label = paste0(X, " (", 1, "), gNID = ", sprintf('%.4f', as.numeric(gNID)))), 
       aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  facet_wrap(~reorder(label, nwords), nrow = 2, ncol = 4) +
  geom_tile() +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(17) +
  guides(fill = guide_legend(title = 'Word')) +
  ggtitle('simulated paradigms')
# ggsave(paste0('figures/mu_0.3_optimal_simulated_lexicon', num_dists, '.png'), plot = p2, height = 4, width = 12, unit = 'in')

p <- grid.arrange(p1,p2, nrow=2)
# ggsave(paste0('figures/mu_', toString(mu), '_optimal_lexicon_', num_dists, '.png'), plot = p, width = 15, height = 12, unit = 'in')
ggsave(plot = p, paste0('figures/paper_figures/Figure 6.png'), width = 15, height = 12, units = 'in')
```



Playgrounds for now
```{r}

ggplot(d, aes(x = `I.M.W.`, y = `I.U.W.`, color = gNID)) +
  facet_grid(rows = vars(LangCategory), cols = vars(systematicity)) +
  geom_jitter(width = 0.02, height = 0.005) +
  geom_point(data=curve_non_deter, aes(x=complexity, y=informativity), color = 'red', alpha = 0.2) +
  theme_bw(15)

ggplot() +
  geom_point(data=d %>% filter(LangCategory == 'simulated'), aes(x=gNID, y=systematicity), color='black', alpha = 0.1) +
  geom_point(data=real_paradigm_summary, aes(x=gNID, y=systematicity, size=n), color='blue') +
  theme_bw(15)

```
